/* Minimalist System Font Stack */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  background: linear-gradient(45deg, #3b82f6, #a78bfa, #ec4899, #22d3ee);
  background-size: 400%;
  animation: gradientBackground 15s ease infinite; /* Renamed animation */
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
  box-sizing: border-box;
  color: #1f2937; /* Default text color */
  line-height: 1.5;
  position: relative; /* Needed for pseudo-element positioning */
  overflow: hidden; /* Hide potential overflow from pattern */
}

/* Geometric Pattern Overlay */
body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1; /* Place behind content */
    background-image:
        repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.07) 0px,
            rgba(255, 255, 255, 0.07) 1px,
            transparent 1px,
            transparent 11px
        ),
        repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.07) 0px,
            rgba(255, 255, 255, 0.07) 1px,
            transparent 1px,
            transparent 11px
        ),
        repeating-linear-gradient(
            45deg,
            rgba(255, 255, 255, 0.09) 0px,
            rgba(255, 255, 255, 0.09) 1px,
            transparent 1px,
            transparent 11px
        ),
         repeating-linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.09) 0px,
            rgba(255, 255, 255, 0.09) 1px,
            transparent 1px,
            transparent 11px
        );
    background-size: 11px 11px;
    opacity: 0.8; /* Translucency */
    pointer-events: none; /* Allow clicks to pass through */
}


@keyframes gradientBackground { /* Renamed animation */
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

h1.main-title {
    text-align: center;
    color: white;
    font-size: 3em; /* Slightly larger */
    margin-bottom: 20px; /* Reduced margin */
    font-weight: normal; /* Minimalist font weight */
    text-shadow: 1px 1px 3px rgba(0,0,0,0.2); /* Subtle shadow */
    padding: 0 10px; /* Prevent hitting edges on small screens */
}

/* Main layout container for gradient, controls, history, export */
.main-content-wrapper {
    display: flex;
    flex-wrap: wrap; /* Allow items to wrap */
    justify-content: center;
    gap: 30px; /* Space between major sections */
    width: 100%;
    max-width: 960px; /* Increased max width */
    padding: 0 20px; /* Padding on sides */
    box-sizing: border-box;
    z-index: 1; /* Ensure content is above pattern */
    position: relative; /* Needed for z-index to work */
}

.gradient-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    flex-shrink: 0; /* Prevent shrinking */
    width: 300px; /* Fixed width on desktop */
}

.rgb-gradient {
  width: 300px; /* Fixed width */
  height: 300px; /* Fixed height */
  position: relative;
  border-radius: 8px;
  cursor: crosshair;
  overflow: hidden;
  background: linear-gradient(to right,
      hsl(0, 100%, 50%), hsl(30, 100%, 50%), hsl(60, 100%, 50%), hsl(90, 100%, 50%),
      hsl(120, 100%, 50%), hsl(150, 100%, 50%), hsl(180, 100%, 50%), hsl(210, 100%, 50%),
      hsl(240, 100%, 50%), hsl(270, 100%, 50%), hsl(300, 100%, 50%), hsl(330, 100%, 50%),
      hsl(360, 100%, 50%));
  outline: 2px solid transparent;
  transition: outline-color 0.2s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* Subtle shadow */
}

.rgb-gradient:focus {
    outline-color: rgba(255, 255, 255, 0.5); /* Whiteish outline on focus */
}

.rgb-gradient::after {
  content: '';
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%; /* Cover the entire gradient */
  background: linear-gradient(to bottom, white 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0) 50%, black 100%);
}

.gradient-legend {
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    text-align: center;
}

.controls-area {
    display: flex;
    flex-direction: column;
    gap: 20px;
    flex-grow: 1; /* Allow controls to grow */
    max-width: 400px; /* Max width for controls on desktop */
    min-width: 280px; /* Minimum width before stacking */
}

.preview {
  width: 100%;
  height: 180px; /* Further reduced height */
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #e5e7eb; /* Default background */
  transition: background 0.2s ease, box-shadow 0.3s ease, outline 0.3s ease;
  padding: 15px;
  box-sizing: border-box;
  outline: 2px solid transparent; /* Slightly thinner outline */
  box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* Subtle shadow */
}

.preview.locked {
    outline: 2px solid rgba(255, 255, 255, 0.8); /* Whiteish outline for selected */
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); /* Subtle white glow */
}

.preview-text {
    margin: 1px 0; /* Even smaller margin */
    font-size: 0.9em; /* Relative font size */
    font-weight: 600;
    background-color: rgba(255,255,255,0.8); /* Slightly more opaque background */
    padding: 2px 6px; /* Adjusted padding */
    border-radius: 4px;
    text-align: center;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #1f2937; /* Always dark text */
}

/* HSL Sliders Styling */
.hsl-sliders {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Reduced gap */
    width: 100%;
}

.slider-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.slider-group label {
    font-size: 0.9em;
    color: white;
    font-weight: normal;
    width: 15px;
    text-align: center; /* Center label */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    opacity: 0.9;
}

input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 6px; /* Thinner slider track */
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px; /* Smaller radius */
    outline: none;
    cursor: pointer;
    flex-grow: 1;
    margin: 0; /* Remove default margin */
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px; /* Smaller thumb */
    height: 16px; /* Smaller thumb */
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3); /* Subtle shadow */
    margin-top: -5px; /* Adjust to center thumb on track */
    border: 1px solid rgba(0,0,0,0.1); /* Subtle border */
}

input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    border: 1px solid rgba(0,0,0,0.1);
}

.slider-value {
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.9);
    text-align: right;
    width: 30px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-weight: normal;
}

/* Container for palette controls and history */
.palette-controls-and-history {
    display: flex;
    flex-direction: row; /* Arrange children horizontally */
    gap: 20px; /* Space between controls and history */
    width: 100%;
    flex-wrap: wrap; /* Allow wrapping on smaller screens */
}


/* Palette Controls */
.palette-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
    /* Adjust width to fit alongside history */
    flex-basis: 250px; /* Give controls a base width */
    flex-grow: 1; /* Allow controls to grow */
    min-width: 200px; /* Prevent controls from getting too small */
}

.control-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.control-group label {
    font-size: 0.9em;
    color: white;
    font-weight: normal;
    width: 60px; /* Adjusted label width */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    opacity: 0.9;
}

/* Custom Select and Number Input Styling */
.select-wrapper {
    position: relative;
    flex-grow: 1;
    background-color: rgba(255, 255, 255, 0.95); /* Slightly more opaque */
    border-radius: 4px;
    overflow: hidden; /* Hide default arrow */
    display: flex; /* Use flex to align select and custom arrow */
    align-items: center;
    min-width: 100px; /* Ensure minimum width */
}

.select-wrapper select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    padding: 8px 12px; /* Adjusted padding */
    border: none;
    background: transparent; /* Make select background transparent */
    font-family: inherit;
    font-size: 0.9em;
    color: #1f2937;
    outline: none;
    cursor: pointer;
    flex-grow: 1; /* Allow select to grow */
}

/* Add a custom arrow for select */
.select-wrapper::after {
    content: 'â–¼'; /* Unicode down arrow */
    font-size: 0.8em;
    color: #1f2937;
    pointer-events: none; /* Allow clicks to pass through */
    padding-right: 8px; /* Space for the arrow */
}

.palette-size-input-wrapper {
    display: flex;
    align-items: center;
    flex-grow: 1; /* Allow wrapper to grow */
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 4px;
    overflow: hidden;
    position: relative; /* Needed for positioning arrows */
     min-width: 100px; /* Ensure minimum width, match select-wrapper */
}


input[type="number"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%; /* Occupy full width within wrapper */
    padding: 8px 0px; /* Adjusted padding */
    border: none;
    background: transparent; /* Make background transparent */
    font-family: inherit;
    font-size: 0.9em;
    color: #1f2937;
    outline: none;
    text-align: center; /* Center the number */
    flex-grow: 1; /* Allow input to grow */
    padding-left: 12px; /* Add left padding */
    padding-right: 30px; /* Make space for arrows */
}

/* Hide default number input arrows */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield; /* Firefox */
}

.number-input-arrows {
    display: flex;
    flex-direction: column;
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 25px; /* Increased width for arrows */
    justify-content: center;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.95); /* Match input background */
    padding-right: 4px; /* Space on the right */
}

.number-input-arrows .arrow {
    display: block;
    width: 0;
    height: 0;
    border-left: 6px solid transparent; /* Increased size */
    border-right: 6px solid transparent; /* Increased size */
    cursor: pointer;
    margin: 3px 0; /* Increased margin */
    background: none;
    border-color: transparent;
    padding: 0;
    outline: none; /* Remove default button outline */
    transition: opacity 0.1s ease;
}

.number-input-arrows .arrow.up {
    border-bottom: 6px solid #1f2937; /* Increased size, Dark arrow */
}

.number-input-arrows .arrow.down {
    border-top: 6px solid #1f2937; /* Increased size, Dark arrow */
}

.number-input-arrows .arrow:hover {
    opacity: 0.7;
}


/* Ensure focus style applies to wrapper for select and number input */
.select-wrapper:focus-within,
.palette-size-input-wrapper:focus-within {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}


/* History Area */
.history-area {
    display: flex; /* Arrange heading and swatches horizontally */
    flex-direction: row;
    align-items: center; /* Vertically center content */
    gap: 10px; /* Space between heading and swatches */
    flex-grow: 1; /* Allow history area to grow */
    flex-basis: 250px; /* Give history a base width */
    min-width: 200px; /* Prevent history from getting too small */
    box-sizing: border-box;
    z-index: 1; /* Ensure history is above pattern */
    position: relative;
    margin-top: 0; /* Remove top margin as it's part of flex row */
}

.history-area h2 {
    color: white;
    font-size: 0.9em; /* Match label font size */
    margin: 0; /* Remove default margin */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-weight: normal;
    opacity: 0.9;
    width: 60px; /* Match label width */
    text-align: left;
    flex-shrink: 0; /* Prevent heading from shrinking */
}

.history-swatches {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start; /* Align swatches to the left */
    gap: 8px; /* Reduced gap */
    flex-grow: 1; /* Allow swatches container to grow */
     /* Constrain width to the available space next to the heading */
    max-width: calc(100% - 70px); /* Subtract label width + gap */
}

.history-swatch {
    width: 35px; /* Slightly smaller */
    height: 35px; /* Slightly smaller */
    border-radius: 5px; /* Smaller radius */
    cursor: pointer;
    transition: transform 0.1s ease, box-shadow 0.2s ease, outline-color 0.2s ease;
    border: 1px solid rgba(255, 255, 255, 0.4); /* Thinner border */
    outline: 2px solid transparent;
    outline-offset: 2px;
    box-sizing: border-box;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.history-swatch:hover {
    transform: scale(1.05); /* Subtle scale */
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.history-swatch:focus {
    outline-color: rgba(255, 255, 255, 0.8);
}

/* Container for action buttons */
.action-buttons {
    display: flex;
    gap: 20px; /* Space between buttons */
    width: 100%;
    margin-top: 10px; /* Space above buttons */
    flex-wrap: wrap; /* Allow buttons to wrap */
}

/* Buttons */
.action-button {
    flex-grow: 1; /* Allow buttons to grow and take equal space */
    flex-basis: 0; /* Start with a base of 0 and grow */
    padding: 12px 24px;
    border: none;
    background: rgba(255, 255, 255, 0.95); /* Light background */
    color: #1f2937; /* Dark text */
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    font-size: 1em;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    outline: none;
    text-align: center; /* Center button text */
}

.action-button:hover {
    background: #fff; /* Slightly lighter on hover */
    box-shadow: 0 44px 12px rgba(0,0,0,0.2);
}
.action-button:active { transform: scale(0.98); }
.action-button:focus {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.generate-button { margin-top: 0; } /* Remove top margin as it's in flex container */
.export-button { margin-top: 0; } /* Remove top margin as it's in flex container */

/* Fullscreen Palette Overlay */
.palette {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  display: none;
  flex-direction: column;
  background-color: rgba(0,0,0,0.9); /* Darker, more minimal overlay */
  z-index: 1000;
  box-sizing: border-box;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

.palette-bar {
  flex: 1;
  min-height: 60px; /* Slightly taller bars */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 1em;
  cursor: pointer;
  position: relative;
  transition: opacity 0.5s ease-in-out, filter 0.2s ease;
  opacity: 0;
  font-weight: 600;
  color: white; /* JS sets this based on luminance */
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  padding: 10px;
  box-sizing: border-box;
  overflow: hidden; /* Hide anything outside */
  border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Subtle separator */
}

.palette-bar:last-child {
    border-bottom: none; /* No border on the last one */
}

.palette-bar:hover {
    filter: brightness(1.05); /* Subtle hover effect */
}

.palette-bar.show {
  opacity: 1;
}

/* Container for the color info text inside bar */
.color-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%; /* Take full height of the bar */
    transition: opacity 0.3s ease; /* Fade transition for text */
}

.color-info span {
    display: block;
    font-size: 0.85em; /* Adjusted font size */
    margin: 1px 0; /* Reduced margin */
    background-color: rgba(255, 255, 255, 0.15); /* Lighter background */
    padding: 2px 6px;
    border-radius: 3px;
    text-align: center;
    color: inherit; /* Inherit color from parent .palette-bar */
}

/* Text fade animation */
.color-info.fade-out { opacity: 0; }
.color-info.fade-in { opacity: 1; }

/* Copy Glow Animation (dynamic color applied via JS inline style) */
@keyframes copiedGlow {
  0% { box-shadow: inset 0 0 0px 0px var(--glow-color, rgba(255, 255, 255, 0.5)); }
  50% { box-shadow: inset 0 0 30px 8px var(--glow-color, rgba(255, 255, 255, 0.5)); } /* Larger glow */
  100% { box-shadow: inset 0 0 0px 0px var(--glow-color, rgba(255, 255, 255, 0.5)); }
}

.palette-bar.copied {
    animation: copiedGlow 1s ease-out forwards; /* Keep last frame */
}

/* Remove Button on Palette Bar */
.remove-color {
    position: absolute;
    top: 8px; /* Adjusted position */
    right: 8px; /* Adjusted position */
    background: rgba(255, 0, 0, 0.7); /* Slightly more opaque red */
    color: white;
    border: none;
    border-radius: 50%; /* Circle button */
    width: 22px; /* Larger */
    height: 22px; /* Larger */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1em; /* Larger font */
    cursor: pointer;
    opacity: 0; /* Hide by default */
    transition: background 0.2s ease, opacity 0.2s ease;
    line-height: 1;
    padding: 0;
    z-index: 1; /* Ensure button is above text */
    box-shadow: 0 1px 4px rgba(0,0,0,0.2);
}

.palette-bar:hover .remove-color {
    opacity: 1; /* Show on hover */
}

.remove-color:hover {
    background: rgba(255, 0, 0, 1); /* Solid red on hover */
}
.remove-color:focus { /* Add focus style */
    outline: 2px solid rgba(255, 255, 255, 0.8);
    outline-offset: 2px;
}

/* Escape Instruction on Palette Overlay */
.palette-escape-instruction {
    position: sticky;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    color: #e0e0e0; /* Lighter text */
    font-size: 0.9em; /* Slightly smaller */
    padding: 8px 16px; /* Adjusted padding */
    background-color: rgba(0, 0, 0, 0.7); /* More opaque */
    border-radius: 0 0 8px 8px;
    text-align: center;
    z-index: 1002;
    width: fit-content;
    margin-bottom: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}


/* Media Queries for Responsiveness */
@media (max-width: 768px) {
    body { padding: 10px; }
     body::before { background-size: 8px 8px; } /* Adjust pattern size */
    h1.main-title {
        font-size: 2em;
        margin-bottom: 15px;
    }
    .main-content-wrapper {
        gap: 20px;
        padding: 0 10px;
        flex-direction: column; /* Stack columns on smaller screens */
        align-items: center;
    }
     .gradient-container {
        width: 100%; /* Take full width */
        max-width: 320px; /* Limit max width */
     }
    .rgb-gradient {
        width: 100%;
        height: auto; /* Allow height to scale with width */
        padding-top: 100%; /* Maintain 1:1 aspect ratio */
        position: relative; /* Needed for padding hack */
    }
    .rgb-gradient::after { /* Make sure pseudo-element covers the area */
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
    }
    .gradient-legend { font-size: 0.8em; }
    .controls-area {
        width: 100%; /* Take full width */
        max-width: 320px; /* Limit max width */
    }
    .preview { height: 120px; } /* Further reduce preview height */
    .preview-text { font-size: 0.8em; }
    .hsl-sliders { gap: 6px; } /* Smaller gaps */
    .slider-group label { width: auto; }
    .slider-group span.slider-value { width: 25px; }

    .palette-controls-and-history {
         flex-direction: column; /* Stack controls and history */
         gap: 15px; /* Space between stacked sections */
     }
     .palette-controls, .history-area {
         flex-basis: auto; /* Remove base width */
         min-width: auto; /* Remove min width */
         width: 100%; /* Take full width of controls-area */
     }
     .history-area {
         flex-direction: column; /* Stack heading and swatches */
         align-items: flex-start; /* Align heading and swatches to the left */
         gap: 8px; /* Space between heading and swatches */
     }
     .history-area h2 { width: auto; } /* Allow heading width to be auto */
     .history-swatches { max-width: 100%; justify-content: center;} /* Allow swatches to use full width */

     .action-buttons { gap: 10px; } /* Smaller gap for buttons */
    .action-button { padding: 10px 20px; font-size: 0.9em; }

    .history-swatch { width: 30px; height: 30px; }
    .palette-bar { min-height: 50px; }
    .palette-bar span { font-size: 0.75em; }
    .palette-escape-instruction { font-size: 0.85em; }
    .remove-color { width: 20px; height: 20px; font-size: 0.8em; top: 6px; right: 6px; }
     .number-input-arrows { width: 20px; padding-right: 2px;}
    .number-input-arrows .arrow { border-left-width: 5px; border-right-width: 5px; border-bottom-width: 5px; border-top-width: 5px; margin: 2px 0;}
}

@media (max-width: 480px) {
    h1.main-title { font-size: 1.8em; }
    body::before { background-size: 6px 6px; } /* Adjust pattern size */
    .main-content-wrapper { padding: 0 5px; gap: 15px; }
    .gradient-container, .controls-area { max-width: 280px; }
    .rgb-gradient { width: 100%; padding-top: 100%; }
    .preview { height: 100px; }
    .preview-text { font-size: 0.7em; padding: 1px 4px; }
    .slider-group label, .control-group label { font-size: 0.85em; }
    .slider-value { font-size: 0.8em; width: 20px; }
    .action-button { font-size: 0.85em; padding: 8px 15px; }
    .history-area, .export-button { max-width: 280px; }
    .history-area h2 { font-size: 1.2em; }
    .history-swatch { width: 25px; height: 25px; }
    .palette-bar span { font-size: 0.7em; padding: 1px 4px;}
    .palette-escape-instruction { font-size: 0.8em; padding: 6px 12px; }
    .number-input-arrows { width: 18px; padding-right: 1px;}
     .number-input-arrows .arrow { border-left-width: 4px; border-right-width: 4px; border-bottom-width: 4px; border-top-width: 4px; margin: 1px 0;}
}