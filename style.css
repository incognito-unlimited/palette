/* Minimalist System Font Stack */
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
  background: linear-gradient(45deg, #3b82f6, #a78bfa, #ec4899, #22d3ee);
  background-size: 400%;
  animation: gradientBackground 15s ease infinite; /* Renamed animation */
  margin: 0;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0px;
  box-sizing: border-box;
  color: #1f2937; /* Default text color */
  line-height: 1.5;
  position: relative; /* Needed for pseudo-element positioning and animated shapes */
  overflow-x: hidden; /* Hide horizontal overflow */
  overflow-y: auto; /* Allow vertical scrolling */
}

/* Geometric Pattern Overlay */
body::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1; /* Place behind content */
    background-image:
        repeating-linear-gradient(
            0deg,
            rgba(255, 255, 255, 0.07) 0px,
            rgba(255, 255, 255, 0.07) 1px,
            transparent 1px,
            transparent 11px
        ),
        repeating-linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.07) 0px,
            rgba(255, 255, 255, 0.07) 1px,
            transparent 1px,
            transparent 11px
        ),
        repeating-linear-gradient(
            45deg,
            rgba(255, 255, 255, 0.09) 0px,
            rgba(255, 255, 255, 0.09) 1px,
            transparent 1px,
            transparent 11px
        ),
         repeating-linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.09) 0px,
            rgba(255, 255, 255, 0.09) 1px,
            transparent 1px,
            transparent 11px
        );
    background-size: 11px 11px;
    opacity: 0.8; /* Translucency */
    pointer-events: none; /* Allow clicks to pass through */
    z-index: -1; /* Ensure pattern is behind geometric shapes */
}


@keyframes gradientBackground { /* Renamed animation */
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

h1.main-title {
    text-align: center;
    color: white;
    font-size: 3em; /* Slightly larger */
    margin-bottom: 20px; /* Reduced margin */
    font-weight: normal; /* Minimalist font weight */
    text-shadow: 1px 1px 3px rgba(0,0,0,0.2); /* Subtle shadow */
    padding: 0 10px; /* Prevent hitting edges on small screens */
    z-index: 2; /* Ensure title is above other elements */
    position: relative; /* Needed for z-index to work */
}

/* Main layout container for gradient, controls, history, export */
.main-content-wrapper {
    display: flex;
    flex-wrap: wrap; /* Allow items to wrap */
    justify-content: center;
    gap: 30px; /* Space between major sections */
    width: 100%;
    max-width: 960px; /* Increased max width */
    padding: 0 20px; /* Padding on sides */
    box-sizing: border-box;
    z-index: 1; /* Ensure content is above background elements */
    position: relative; /* Needed for z-index to work */
     margin: auto; /* Added to vertically center the content */
}

.gradient-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    flex-shrink: 0; /* Prevent shrinking */
    width: 300px; /* Fixed width on desktop */
}

.rgb-gradient {
  width: 300px; /* Fixed width */
  height: 300px; /* Fixed height */
  position: relative;
  border-radius: 8px;
  cursor: crosshair;
  overflow: hidden;
  background: linear-gradient(to right,
      hsl(0, 100%, 50%), hsl(30, 100%, 50%), hsl(60, 100%, 50%), hsl(90, 100%, 50%),
      hsl(120, 100%, 50%), hsl(150, 100%, 50%), hsl(180, 100%, 50%), hsl(210, 100%, 50%),
      hsl(240, 100%, 50%), hsl(270, 100%, 50%), hsl(300, 100%, 50%), hsl(330, 100%, 50%),
      hsl(360, 100%, 50%));
  outline: 2px solid transparent;
  transition: outline-color 0.2s ease;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* Subtle shadow */
}

.rgb-gradient:focus {
    outline-color: rgba(255, 255, 255, 0.5); /* Whiteish outline on focus */
}

.rgb-gradient::after {
  content: '';
  position: absolute;
  top: 0; left: 0; width: 100%; height: 100%; /* Cover the entire gradient */
  background: linear-gradient(to bottom, white 0%, rgba(255,255,255,0) 50%, rgba(0,0,0,0) 50%, black 100%);
}

.gradient-legend {
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.9);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    text-align: center;
}


.controls-area {
    display: flex;
    flex-direction: column;
    gap: 20px;
    flex-grow: 1; /* Allow controls to grow */
    max-width: 400px; /* Max width for controls on desktop */
    min-width: 280px; /* Minimum width before stacking */
}

.preview {
  width: 100%;
  height: 180px; /* Further reduced height */
  border-radius: 8px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  background: #e5e7eb; /* Default background */
  transition: background 0.2s ease, box-shadow 0.3s ease, outline 0.3s ease;
  padding: 15px;
  box-sizing: border-box;
  outline: 2px solid transparent; /* Slightly thinner outline */
  box-shadow: 0 2px 8px rgba(0,0,0,0.15); /* Subtle shadow */
}

.preview.locked {
    outline: 2px solid rgba(255, 255, 255, 0.8); /* Whiteish outline for selected */
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5); /* Subtle white glow */
}

.preview-text {
    margin: 1px 0; /* Even smaller margin */
    font-size: 0.9em; /* Relative font size */
    font-weight: 600;
    background-color: rgba(255,255,255,0.8); /* Slightly more opaque background */
    padding: 2px 6px; /* Adjusted padding */
    border-radius: 4px;
    text-align: center;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    color: #1f2937; /* Always dark text */
}

/* Instruction text inside the preview box */
.preview-instruction {
    display: none; /* Hidden by default, controlled by JS */
    font-size: 0.9em; /* Match Harmony label font size */
    text-align: center;
    margin-top: 8px; /* Space above the text */
    white-space: nowrap; /* Prevent text wrapping */
    /* Color will be set by JS */
}


/* HSL Sliders Styling */
.hsl-sliders {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Reduced gap */
    width: 100%;
}

.slider-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.slider-group label {
    font-size: 0.9em;
    color: white;
    font-weight: normal;
    width: 15px;
    text-align: center; /* Center label */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    opacity: 0.9;
}

input[type="range"] {
    -webkit-appearance: none;
    appearance: none;
    height: 6px; /* Thinner slider track */
    background: rgba(255, 255, 255, 0.3);
    border-radius: 3px; /* Smaller radius */
    outline: none;
    cursor: pointer;
    flex-grow: 1;
    margin: 0; /* Remove default margin */
}

input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 16px; /* Smaller thumb */
    height: 16px; /* Smaller thumb */
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3); /* Subtle shadow */
    margin-top: -5px; /* Adjust to center thumb on track */
    border: 1px solid rgba(0,0,0,0.1); /* Subtle border */
}

input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    border: 1px solid rgba(0,0,0,0.1);
}

.slider-value {
    font-size: 0.9em;
    color: rgba(255, 255, 255, 0.9);
    text-align: right;
    width: 30px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-weight: normal;
}

/* Container for palette controls and history */
.palette-controls-and-history {
    display: flex;
    flex-direction: row; /* Arrange children horizontally */
    gap: 20px; /* Space between controls and history */
    width: 100%;
    flex-wrap: wrap; /* Allow buttons to wrap */
}


/* Palette Controls */
.palette-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
    /* Adjust width to fit alongside history */
    flex-basis: 250px; /* Give controls a base width */
    flex-grow: 1; /* Allow controls to grow */
    min-width: 200px; /* Prevent controls from getting too small */
}

.control-group {
    display: flex;
    align-items: center;
    gap: 10px;
}

.control-group label {
    font-size: 0.9em;
    color: white;
    font-weight: normal;
    width: 60px; /* Adjusted label width */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    opacity: 0.9;
}

/* Custom Select and Number Input Styling */
.select-wrapper {
    position: relative;
    flex-grow: 1;
    background-color: rgba(255, 255, 255, 0.95); /* Slightly more opaque */
    border-radius: 4px;
    overflow: hidden; /* Hide default arrow */
    display: flex; /* Use flex to align select and custom arrow */
    align-items: center;
    min-width: 100px; /* Ensure minimum width */
}

.select-wrapper select {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%;
    padding: 8px 12px; /* Adjusted padding */
    border: none;
    background: transparent; /* Make select background transparent */
    font-family: inherit;
    font-size: 0.9em;
    color: #1f2937;
    outline: none;
    cursor: pointer;
    flex-grow: 1; /* Allow select to grow */
}

/* Add a custom arrow for select */
.select-wrapper::after {
    content: 'â–¼'; /* Unicode down arrow */
    font-size: 0.8em;
    color: #1f2937;
    pointer-events: none; /* Allow clicks to pass through */
    padding-right: 8px; /* Space for the arrow */
}

.palette-size-input-wrapper {
    display: flex;
    align-items: center;
    flex-grow: 1; /* Allow wrapper to grow */
    background-color: rgba(255, 255, 255, 0.95);
    border-radius: 4px;
    overflow: hidden;
    position: relative; /* Needed for positioning arrows */
     min-width: 100px; /* Ensure minimum width, match select-wrapper */
}


input[type="number"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    width: 100%; /* Occupy full width within wrapper */
    padding: 8px 0px; /* Adjusted padding */
    border: none;
    background: transparent; /* Make background transparent */
    font-family: inherit;
    font-size: 0.9em;
    color: #1f2937;
    outline: none;
    text-align: center; /* Center the number */
    flex-grow: 1; /* Allow input to grow */
    padding-left: 12px; /* Add left padding */
    padding-right: 30px; /* Make space for arrows */
}

/* Hide default number input arrows */
input[type=number]::-webkit-outer-spin-button,
input[type=number]::-webkit-inner-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield; /* Firefox */
}

.number-input-arrows {
    display: flex;
    flex-direction: column;
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 25px; /* Increased width for arrows */
    justify-content: center;
    align-items: center;
    background-color: rgba(255, 255, 255, 0.95); /* Match input background */
    padding-right: 4px; /* Space on the right */
}

.number-input-arrows .arrow {
    display: block;
    width: 0;
    height: 0;
    border-left: 6px solid transparent; /* Increased size */
    border-right: 6px solid transparent; /* Increased size */
    cursor: pointer;
    margin: 3px 0; /* Increased margin */
    background: none;
    border-color: transparent;
    padding: 0;
    outline: none; /* Remove default button outline */
    transition: opacity 0.1s ease;
}

.number-input-arrows .arrow.up {
    border-bottom: 6px solid #1f2937; /* Increased size, Dark arrow */
}

.number-input-arrows .arrow.down {
    border-top: 6px solid #1f2937; /* Increased size, Dark arrow */
}

.number-input-arrows:hover .arrow {
    opacity: 0.7;
}


/* Ensure focus style applies to wrapper for select and number input */
.select-wrapper:focus-within,
.palette-size-input-wrapper:focus-within {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
}


/* History Area */
.history-area {
    display: flex; /* Arrange heading and swatches horizontally */
    flex-direction: row;
    align-items: center; /* Vertically center content */
    gap: 10px; /* Space between heading and swatches */
    flex-grow: 1; /* Allow history area to grow */
    flex-basis: 250px; /* Give history a base width */
    min-width: 200px; /* Prevent history from getting too small */
    box-sizing: border-box;
    z-index: 1; /* Ensure history is above pattern and geometric shapes */
    position: relative;
    margin-top: 0; /* Remove top margin as it's in flex row */
}

.history-area h2 {
    color: white;
    font-size: 0.9em; /* Match label font size */
    margin: 0; /* Remove default margin */
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    font-weight: normal;
    opacity: 0.9;
    width: 60px; /* Match label width */
    text-align: left;
    flex-shrink: 0; /* Prevent heading from shrinking */
}

.history-swatches {
    display: flex;
    flex-wrap: wrap;
    justify-content: flex-start; /* Align swatches to the left */
    gap: 7px; /* Reduced gap */
    flex-grow: 1; /* Allow swatches container to grow */
     /* Constrain width to the available space next to the heading */
    max-width: calc(100% - 70px); /* Subtract label width + gap */
}

.history-swatch {
    width: 35px; /* Slightly smaller */
    height: 35px; /* Slightly smaller */
    border-radius: 5px; /* Smaller radius */
    cursor: pointer;
    transition: transform 0.1s ease, box-shadow 0.2s ease, outline-color 0.2s ease;
    border: 1px solid rgba(255, 255, 255, 0.4); /* Thinner border */
    outline: 2px solid transparent;
    outline-offset: 2px;
    box-sizing: border-box;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
}

.history-swatch:hover {
    transform: scale(1.05); /* Subtle scale */
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
}

.history-swatch:focus {
    outline-color: rgba(255, 255, 255, 0.8);
}

/* Container for action buttons */
.action-buttons {
    display: flex;
    gap: 20px; /* Space between buttons */
    width: 100%;
    margin-top: 10px; /* Space above buttons */
    flex-wrap: wrap; /* Allow buttons to wrap */
}

/* Buttons */
.action-button {
    flex-grow: 1; /* Allow buttons to grow and take equal space */
    flex-basis: 0; /* Start with a base of 0 and grow */
    padding: 12px 24px;
    border: none;
    background: rgba(255, 255, 255, 0.95); /* Light background */
    color: #1f2937; /* Dark text */
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
    font-size: 1em;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    outline: none;
    text-align: center; /* Center button text */
}

.action-button:hover {
    background: #fff; /* Slightly lighter on hover */
    box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.action-button:active { transform: scale(0.98); }
.action-button:focus {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.generate-button { margin-top: 0; } /* Remove top margin as it's in flex container */
.export-button { margin-top: 0; } /* Remove top margin as it's in flex container */

/* Fullscreen Palette Overlay */
.palette {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  display: none;
  flex-direction: column;
  background-color: rgba(0,0,0,0.9); /* Darker, more minimal overlay */
  z-index: 1000;
  box-sizing: border-box;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

.palette-bar {
  flex: 1;
  min-height: 60px; /* Slightly taller bars */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  font-size: 1em;
  cursor: pointer;
  position: relative;
  transition: opacity 0.5s ease-in-out, filter 0.2s ease;
  opacity: 0;
  font-weight: 600;
  color: white; /* JS sets this based on luminance */
  text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
  padding: 10px;
  box-sizing: border-box;
  overflow: hidden; /* Hide anything outside */
  border-bottom: 1px solid rgba(255, 255, 255, 0.1); /* Subtle separator */
}

.palette-bar:last-child {
    border-bottom: none; /* No border on the last one */
}

.palette-bar:hover {
    filter: brightness(1.05); /* Subtle hover effect */
}

.palette-bar.show {
  opacity: 1;
}

/* Container for the color info text inside bar */
.color-info {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%; /* Take full height of the bar */
    transition: opacity 0.3s ease; /* Fade transition for text */
}

.color-info span {
    display: block;
    font-size: 0.85em; /* Adjusted font size */
    margin: 1px 0; /* Reduced margin */
    background-color: rgba(255, 255, 255, 0.15); /* Lighter background */
    padding: 2px 6px;
    border-radius: 3px;
    text-align: center;
    color: inherit; /* Inherit color from parent .palette-bar */
}

/* Text fade animation */
.color-info.fade-out { opacity: 0; }
.color-info.fade-in { opacity: 1; }

/* Copy Glow Animation (dynamic color applied via JS inline style) */
@keyframes copiedGlow {
  0% { box-shadow: inset 0 0 0px 0px var(--glow-color, rgba(255, 255, 255, 0.5)); }
  50% { box-shadow: inset 0 0 30px 8px var(--glow-color, rgba(255, 255, 255, 0.5)); } /* Larger glow */
  100% { box-shadow: inset 0 0 0px 0px var(--glow-color, rgba(255, 255, 255, 0.5)); }
}

.palette-bar.copied {
    animation: copiedGlow 1s ease-out forwards; /* Keep last frame */
}

/* Remove Button on Palette Bar */
.remove-color {
    position: absolute;
    top: 8px; /* Adjusted position */
    right: 8px; /* Adjusted position */
    background: none; /* Removed red background */
    border: none;
    border-radius: 50%; /* Circle button */
    width: 22px; /* Larger */
    height: 22px; /* Larger */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1em; /* Larger font */
    cursor: pointer;
    opacity: 0; /* Hide by default */
    transition: opacity 0.2s ease; /* Simplified transition */
    line-height: 1;
    padding: 0;
    z-index: 1; /* Ensure button is above text */
    color: unset; /* Allow script to set color */
}

.palette-bar:hover .remove-color {
    opacity: 1; /* Show on hover */
}

.remove-color:hover {
    opacity: 0.7; /* Dim slightly on hover */
}
.remove-color:focus { /* Add focus style */
    outline: 2px solid rgba(255, 255, 255, 0.8);
    outline-offset: 2px;
}

/* Mobile Close Button for Palette */
.close-palette-button {
    display: none; /* Hidden by default on desktop */
}

/* Animated Geometric Shapes Background */
.geometric-background {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden; /* Hide shapes outside the container */
    z-index: -2; /* Place behind the main content but above body background */
    pointer-events: none; /* Allow interaction with content behind */
    perspective: 1000px; /* Add perspective for 3D effect */
}

.geometric-background .shape {
    position: absolute;
    width: 0;
    height: 0;
    /* Using border to create a triangle pointing up */
    border-left: 60px solid transparent; /* Base size */
    border-right: 60px solid transparent; /* Base size */
    border-bottom: 100px solid rgba(255, 255, 255, 0.1); /* Base triangle color and size */
    transform-style: preserve-3d; /* Enable 3D transforms */
    opacity: 0.6; /* Base opacity */
    /* Removed drop-shadow for a simpler look */
}

/* Individual shape positioning, size variations, opacity, and animation delays/types */
/* Increased quantity and more varied initial positions and animation properties */
.geometric-background .shape1 {
    top: 5%; left: 10%;
    animation: floatRotate1 25s infinite ease-in-out alternate;
    transform: translateZ(-100px) rotateX(20deg) rotateY(40deg);
    border-bottom-color: rgba(255, 255, 255, 0.15);
}

.geometric-background .shape2 {
    top: 85%; left: 80%;
    animation: floatRotate2 30s infinite ease-in-out alternate-reverse;
    transform: translateZ(-50px) rotateX(-30deg) rotateY(-60deg);
    border-bottom-width: 120px; border-left-width: 72px; border-right-width: 72px;
    border-bottom-color: rgba(255, 255, 255, 0.12);
    opacity: 0.5;
}

.geometric-background .shape3 {
    top: 30%; left: 95%;
    animation: floatRotate3 22s infinite linear;
    transform: translateZ(50px) rotateX(40deg) rotateY(-20deg);
    border-bottom-width: 90px; border-left-width: 54px; border-right-width: 54px;
    border-bottom-color: rgba(255, 255, 255, 0.18);
    opacity: 0.7;
}

.geometric-background .shape4 {
    top: 70%; left: 5%;
    animation: floatRotate4 28s infinite ease alternate;
    transform: translateZ(150px) rotateX(-50deg) rotateY(70deg);
    border-bottom-width: 110px; border-left-width: 66px; border-right-width: 66px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
    opacity: 0.6;
}

.geometric-background .shape5 {
    top: 15%; left: 50%;
     animation: floatRotate5 35s infinite ease-in-out;
     transform: translateZ(-120px) rotateX(60deg) rotateY(-80deg);
     border-bottom-width: 140px; border-left-width: 84px; border-right-width: 84px;
     border-bottom-color: rgba(255, 255, 255, 0.14);
     opacity: 0.55;
}

.geometric-background .shape6 {
    top: 50%; left: 25%;
    animation: floatRotate6 26s infinite linear reverse;
    transform: translateZ(80px) rotateX(10deg) rotateY(100deg);
     border-bottom-width: 105px; border-left-width: 63px; border-right-width: 63px;
     border-bottom-color: rgba(255, 255, 255, 0.08);
     opacity: 0.75;
}

.geometric-background .shape7 {
    top: 25%; left: 75%;
    animation: floatRotate7 32s infinite ease alternate-reverse;
    transform: translateZ(20px) rotateX(-20deg) rotateY(-110deg);
    border-bottom-width: 115px; border-left-width: 69px; border-right-width: 69px;
    border-bottom-color: rgba(255, 255, 255, 0.16);
    opacity: 0.65;
}

.geometric-background .shape8 {
    top: 75%; left: 40%;
    animation: floatRotate8 24s infinite ease-in-out reverse;
    transform: translateZ(-70px) rotateX(50deg) rotateY(130deg);
     border-bottom-width: 135px; border-left-width: 81px; border-right-width: 81px;
    border-bottom-color: rgba(255, 255, 255, 0.11);
    opacity: 0.58;
}

.geometric-background .shape9 {
    top: 45%; left: 5%;
    animation: floatRotate9 29s infinite linear alternate;
    transform: translateZ(100px) rotateX(-40deg) rotateY(-150deg);
    border-bottom-width: 95px; border-left-width: 57px; border-right-width: 57px;
     border-bottom-color: rgba(255, 255, 255, 0.09);
     opacity: 0.72;
}

.geometric-background .shape10 {
    top: 10%; left: 90%;
    animation: floatRotate10 34s infinite ease-in-out alternate-reverse;
    transform: translateZ(-30px) rotateX(30deg) rotateY(160deg);
    border-bottom-width: 125px; border-left-width: 75px; border-right-width: 75px;
    border-bottom-color: rgba(255, 255, 255, 0.17);
    opacity: 0.62;
}

.geometric-background .shape11 {
    top: 80%; left: 20%;
    animation: floatRotate11 27s infinite linear reverse;
    transform: translateZ(110px) rotateX(-10deg) rotateY(-170deg);
    border-bottom-width: 100px; border-left-width: 60px; border-right-width: 60px;
     border-bottom-color: rgba(255, 255, 255, 0.13);
     opacity: 0.68;
}

.geometric-background .shape12 {
    top: 35%; left: 60%;
    animation: floatRotate12 31s infinite ease alternate;
    transform: translateZ(-80px) rotateX(70deg) rotateY(190deg);
    border-bottom-width: 145px; border-left-width: 87px; border-right-width: 87px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
    opacity: 0.7;
}

/* Added styles for shapes 13-30 with varied positions, sizes, opacity, and animation properties */
.geometric-background .shape13 {
    top: 60%; left: 90%;
    animation: floatRotate13 23s infinite ease-in-out alternate;
    transform: translateZ(40px) rotateX(50deg) rotateY(-50deg);
    border-bottom-width: 110px; border-left-width: 66px; border-right-width: 66px;
    border-bottom-color: rgba(255, 255, 255, 0.19);
    opacity: 0.5;
}

.geometric-background .shape14 {
    top: 20%; left: 5%;
    animation: floatRotate14 29s infinite linear reverse;
    transform: translateZ(-60px) rotateX(-20deg) rotateY(20deg);
    border-bottom-width: 95px; border-left-width: 57px; border-right-width: 57px;
    border-bottom-color: rgba(255, 255, 255, 0.11);
    opacity: 0.6;
}

.geometric-background .shape15 {
    top: 90%; left: 30%;
    animation: floatRotate15 34s infinite ease alternate;
    transform: translateZ(130px) rotateX(80deg) rotateY(150deg);
    border-bottom-width: 150px; border-left-width: 90px; border-right-width: 90px;
    border-bottom-color: rgba(255, 255, 255, 0.15);
    opacity: 0.75;
}

.geometric-background .shape16 {
    top: 10%; left: 70%;
    animation: floatRotate16 26s infinite ease-in-out alternate-reverse;
    transform: translateZ(-90px) rotateX(-40deg) rotateY(-100deg);
    border-bottom-width: 100px; border-left-width: 60px; border-right-width: 60px;
    border-bottom-color: rgba(255, 255, 255, 0.13);
    opacity: 0.6;
}

.geometric-background .shape17 {
    top: 80%; left: 15%;
    animation: floatRotate17 31s infinite linear;
    transform: translateZ(70px) rotateX(10deg) rotateY(180deg);
    border-bottom-width: 120px; border-left-width: 72px; border-right-width: 72px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
    opacity: 0.55;
}

.geometric-background .shape18 {
    top: 40%; left: 35%;
    animation: floatRotate18 20s infinite ease reverse;
    transform: translateZ(-110px) rotateX(60deg) rotateY(-140deg);
    border-bottom-width: 130px; border-left-width: 78px; border-right-width: 78px;
    border-bottom-color: rgba(255, 255, 255, 0.18);
    opacity: 0.7;
}

.geometric-background .shape19 {
    top: 65%; left: 55%;
    animation: floatRotate19 27s infinite ease-in-out alternate;
    transform: translateZ(90px) rotateX(-30deg) rotateY(90deg);
    border-bottom-width: 105px; border-left-width: 63px; border-right-width: 63px;
    border-bottom-color: rgba(255, 255, 255, 0.12);
    opacity: 0.65;
}

.geometric-background .shape20 {
    top: 30%; left: 80%;
    animation: floatRotate20 33s infinite linear alternate-reverse;
    transform: translateZ(-40px) rotateX(40deg) rotateY(200deg);
    border-bottom-width: 115px; border-left-width: 69px; border-right-width: 69px;
    border-bottom-color: rgba(255, 255, 255, 0.16);
    opacity: 0.58;
}

.geometric-background .shape21 {
    top: 15%; left: 30%;
    animation: floatRotate21 24s infinite ease reverse;
    transform: translateZ(120px) rotateX(-10deg) rotateY(-210deg);
    border-bottom-width: 140px; border-left-width: 84px; border-right-width: 84px;
    border-bottom-color: rgba(255, 255, 255, 0.09);
    opacity: 0.72;
}

.geometric-background .shape22 {
    top: 85%; left: 50%;
    animation: floatRotate22 30s infinite ease-in-out;
    transform: translateZ(-150px) rotateX(70deg) rotateY(230deg);
    border-bottom-width: 100px; border-left-width: 60px; border-right-width: 60px;
    border-bottom-color: rgba(255, 255, 255, 0.17);
    opacity: 0.62;
}

.geometric-background .shape23 {
    top: 50%; left: 75%;
    animation: floatRotate23 25s infinite linear alternate;
    transform: translateZ(60px) rotateX(-50deg) rotateY(-250deg);
    border-bottom-width: 130px; border-left-width: 78px; border-right-width: 78px;
    border-bottom-color: rgba(255, 255, 255, 0.11);
    opacity: 0.68;
}

.geometric-background .shape24 {
    top: 25%; left: 20%;
    animation: floatRotate24 32s infinite ease alternate-reverse;
    transform: translateZ(-80px) rotateX(30deg) rotateY(270deg);
    border-bottom-width: 110px; border-left-width: 66px; border-right-width: 66px;
    border-bottom-color: rgba(255, 255, 255, 0.19);
    opacity: 0.5;
}

.geometric-background .shape25 {
    top: 70%; left: 95%;
    animation: floatRotate25 28s infinite ease-in-out reverse;
    transform: translateZ(100px) rotateX(-20deg) rotateY(-290deg);
    border-bottom-width: 95px; border-left-width: 57px; border-right-width: 57px;
    border-bottom-color: rgba(255, 255, 255, 0.13);
    opacity: 0.75;
}

.geometric-background .shape26 {
    top: 5%; left: 40%;
    animation: floatRotate26 21s infinite linear;
    transform: translateZ(-120px) rotateX(80deg) rotateY(310deg);
    border-bottom-width: 140px; border-left-width: 84px; border-right-width: 84px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
    opacity: 0.6;
}

.geometric-background .shape27 {
    top: 90%; left: 70%;
    animation: floatRotate27 35s infinite ease alternate;
    transform: translateZ(50px) rotateX(-60deg) rotateY(-330deg);
    border-bottom-width: 150px; border-left-width: 90px; border-right-width: 90px;
    border-bottom-color: rgba(255, 255, 255, 0.15);
    opacity: 0.55;
}

.geometric-background .shape28 {
    top: 20%; left: 60%;
    animation: floatRotate28 26s infinite ease-in-out alternate-reverse;
    transform: translateZ(-70px) rotateX(40deg) rotateY(350deg);
    border-bottom-width: 100px; border-left-width: 60px; border-right-width: 60px;
    border-bottom-color: rgba(255, 255, 255, 0.12);
    opacity: 0.68;
}

.geometric-background .shape29 {
    top: 75%; left: 10%;
    animation: floatRotate29 30s infinite linear reverse;
    transform: translateZ(110px) rotateX(-10deg) rotateY(-370deg);
    border-bottom-width: 120px; border-left-width: 72px; border-right-width: 72px;
    border-bottom-color: rgba(255, 255, 255, 0.16);
    opacity: 0.7;
}

.geometric-background .shape30 {
    top: 40%; left: 45%;
    animation: floatRotate30 22s infinite ease alternate;
    transform: translateZ(-90px) rotateX(50deg) rotateY(390deg);
    border-bottom-width: 135px; border-left-width: 81px; border-right-width: 81px;
    border-bottom-color: rgba(255, 255, 255, 0.11);
    opacity: 0.65;
}


/* Keyframe Animations for Floating and Rotating */
/* More varied and slightly simpler animation paths */

@keyframes floatRotate1 {
    0% { transform: translate3d(0, 0, -100px) rotateX(20deg) rotateY(40deg); }
    50% { transform: translate3d(80px, -40px, 100px) rotateX(110deg) rotateY(130deg); }
    100% { transform: translate3d(0, 0, -100px) rotateX(200deg) rotateY(220deg); }
}

@keyframes floatRotate2 {
    0% { transform: translate3d(0, 0, -50px) rotateX(-30deg) rotateY(-60deg); }
    50% { transform: translate3d(-100px, 50px, 80px) rotateX(-130deg) rotateY(-160deg); }
    100% { transform: translate3d(0, 0, -50px) rotateX(-230deg) rotateY(-260deg); }
}

@keyframes floatRotate3 {
    0% { transform: translate3d(0, 0, 50px) rotateX(40deg) rotateY(-20deg); }
    50% { transform: translate3d(-80px, -100px, 150px) rotateX(140deg) rotateY(-120deg); }
    100% { transform: translate3d(0, 0, 50px) rotateX(240deg) rotateY(-220deg); }
}

@keyframes floatRotate4 {
    0% { transform: translate3d(0, 0, 150px) rotateX(-50deg) rotateY(70deg); }
    50% { transform: translate3d(60px, 120px, 50px) rotateX(-150deg) rotateY(170deg); }
    100% { transform: translate3d(0, 0, 150px) rotateX(-250deg) rotateY(270deg); }
}

@keyframes floatRotate5 {
    0% { transform: translate3d(0, 0, -120px) rotateX(60deg) rotateY(-80deg); }
    50% { transform: translate3d(0px, 140px, 100px) rotateX(160deg) rotateY(-180deg); }
    100% { transform: translate3d(0, 0, -120px) rotateX(260deg) rotateY(-280deg); }
}

@keyframes floatRotate6 {
    0% { transform: translate3d(0, 0, 80px) rotateX(10deg) rotateY(100deg); }
    50% { transform: translate3d(100px, -80px, -20px) rotateX(110deg) rotateY(200deg); }
    100% { transform: translate3d(0, 0, 80px) rotateX(210deg) rotateY(300deg); }
}

@keyframes floatRotate7 {
    0% { transform: translate3d(0, 0, 20px) rotateX(-20deg) rotateY(-110deg); }
    50% { transform: translate3d(-120px, -60px, 100px) rotateX(-120deg) rotateY(-210deg); }
    100% { transform: translate3d(0, 0, 20px) rotateX(-220deg) rotateY(-310deg); }
}

@keyframes floatRotate8 {
    0% { transform: translate3d(0, 0, -70px) rotateX(50deg) rotateY(130deg); }
    50% { transform: translate3d(130px, 70px, 0px) rotateX(150deg) rotateY(230deg); }
    100% { transform: translate3d(0, 0, -70px) rotateX(250deg) rotateY(330deg); }
}

@keyframes floatRotate9 {
    0% { transform: translate3d(0, 0, 100px) rotateX(-40deg) rotateY(-150deg); }
    50% { transform: translate3d(-90px, 90px, 40px) rotateX(-140deg) rotateY(-250deg); }
    100% { transform: translate3d(0, 0, 100px) rotateX(-240deg) rotateY(-350deg); }
}

@keyframes floatRotate10 {
    0% { transform: translate3d(0, 0, -30px) rotateX(30deg) rotateY(160deg); }
    50% { transform: translate3d(80px, -80px, 120px) rotateX(130deg) rotateY(260deg); }
    100% { transform: translate3d(0, 0, -30px) rotateX(230deg) rotateY(360deg); }
}

@keyframes floatRotate11 {
    0% { transform: translate3d(0, 0, 110px) rotateX(-10deg) rotateY(-170deg); }
    50% { transform: translate3d(-100px, -110px, 0px) rotateX(-110deg) rotateY(-270deg); }
    100% { transform: translate3d(0, 0, 110px) rotateX(-210deg) rotateY(-370deg); }
}

@keyframes floatRotate12 {
    0% { transform: translate3d(0, 0, -80px) rotateX(70deg) rotateY(190deg); }
    50% { transform: translate3d(110px, 80px, -30px) rotateX(170deg) rotateY(290deg); }
    100% { transform: translate3d(0, 0, -80px) rotateX(270deg) rotateY(390deg); }
}

@keyframes floatRotate13 {
    0% { transform: translate3d(0, 0, 40px) rotateX(50deg) rotateY(-50deg); }
    50% { transform: translate3d(90px, -50px, 130px) rotateX(150deg) rotateY(-150deg); }
    100% { transform: translate3d(0, 0, 40px) rotateX(250deg) rotateY(-250deg); }
}

@keyframes floatRotate14 {
    0% { transform: translate3d(0, 0, -60px) rotateX(-20deg) rotateY(20deg); }
    50% { transform: translate3d(-110px, 60px, 90px) rotateX(-120deg) rotateY(120deg); }
    100% { transform: translate3d(0, 0, -60px) rotateX(-220deg) rotateY(220deg); }
}

@keyframes floatRotate15 {
    0% { transform: translate3d(0, 0, 130px) rotateX(80deg) rotateY(150deg); }
    50% { transform: translate3d(70px, 130px, 60px) rotateX(180deg) rotateY(250deg); }
    100% { transform: translate3d(0, 0, 130px) rotateX(280deg) rotateY(350deg); }
}

@keyframes floatRotate16 {
    0% { transform: translate3d(0, 0, -90px) rotateX(-40deg) rotateY(-100deg); }
    50% { transform: translate3d(-100px, -90px, 20px) rotateX(-140deg) rotateY(-200deg); }
    100% { transform: translate3d(0, 0, -90px) rotateX(-240deg) rotateY(-300deg); }
}

@keyframes floatRotate17 {
    0% { transform: translate3d(0, 0, 70px) rotateX(10deg) rotateY(180deg); }
    50% { transform: translate3d(120px, 70px, -10px) rotateX(110deg) rotateY(280deg); }
    100% { transform: translate3d(0, 0, 70px) rotateX(210deg) rotateY(380deg); }
}

@keyframes floatRotate18 {
    0% { transform: translate3d(0, 0, -110px) rotateX(60deg) rotateY(-140deg); }
    50% { transform: translate3d(0px, -110px, 80px) rotateX(160deg) rotateY(-240deg); }
    100% { transform: translate3d(0, 0, -110px) rotateX(260deg) rotateY(-340deg); }
}

@keyframes floatRotate19 {
    0% { transform: translate3d(0, 0, 90px) rotateX(-30deg) rotateY(90deg); }
    50% { transform: translate3d(105px, 90px, 0px) rotateX(-130deg) rotateY(190deg); }
    100% { transform: translate3d(0, 0, 90px) rotateX(-230deg) rotateY(290deg); }
}

@keyframes floatRotate20 {
    0% { transform: translate3d(0, 0, -40px) rotateX(40deg) rotateY(200deg); }
    50% { transform: translate3d(115px, -40px, 100px) rotateX(140deg) rotateY(300deg); }
    100% { transform: translate3d(0, 0, -40px) rotateX(240deg) rotateY(400deg); }
}

@keyframes floatRotate21 {
    0% { transform: translate3d(0, 0, 120px) rotateX(-10deg) rotateY(-210deg); }
    50% { transform: translate3d(-140px, -120px, 10px) rotateX(-110deg) rotateY(-310deg); }
    100% { transform: translate3d(0, 0, 120px) rotateX(-210deg) rotateY(-410deg); }
}

@keyframes floatRotate22 {
    0% { transform: translate3d(0, 0, -150px) rotateX(70deg) rotateY(230deg); }
    50% { transform: translate3d(100px, 150px, -20px) rotateX(170deg) rotateY(330deg); }
    100% { transform: translate3d(0, 0, -150px) rotateX(270deg) rotateY(430deg); }
}

@keyframes floatRotate23 {
    0% { transform: translate3d(0, 0, 60px) rotateX(-50deg) rotateY(-250deg); }
    50% { transform: translate3d(130px, -60px, 30px) rotateX(-150deg) rotateY(-350deg); }
    100% { transform: translate3d(0, 0, 60px) rotateX(-250deg) rotateY(-450deg); }
}

@keyframes floatRotate24 {
    0% { transform: translate3d(0, 0, -80px) rotateX(30deg) rotateY(270deg); }
    50% { transform: translate3d(110px, 80px, -10px) rotateX(130deg) rotateY(370deg); }
    100% { transform: translate3d(0, 0, -80px) rotateX(230deg) rotateY(470deg); }
}

@keyframes floatRotate25 {
    0% { transform: translate3d(0, 0, 100px) rotateX(-20deg) rotateY(-290deg); }
    50% { transform: translate3d(95px, -100px, 40px) rotateX(-120deg) rotateY(-390deg); }
    100% { transform: translate3d(0, 0, 100px) rotateX(-220deg) rotateY(-490deg); }
}

@keyframes floatRotate26 {
    0% { transform: translate3d(0, 0, -120px) rotateX(80deg) rotateY(310deg); }
    50% { transform: translate3d(140px, 120px, -50px) rotateX(180deg) rotateY(410deg); }
    100% { transform: translate3d(0, 0, -120px) rotateX(280deg) rotateY(510deg); }
}

@keyframes floatRotate27 {
    0% { transform: translate3d(0, 0, 50px) rotateX(-60deg) rotateY(-330deg); }
    50% { transform: translate3d(150px, -50px, 20px) rotateX(-160deg) rotateY(-430deg); }
    100% { transform: translate3d(0, 0, 50px) rotateX(-260deg) rotateY(-530deg); }
}

@keyframes floatRotate28 {
    0% { transform: translate3d(0, 0, -70px) rotateX(40deg) rotateY(350deg); }
    50% { transform: translate3d(100px, 70px, -10px) rotateX(140deg) rotateY(450deg); }
    100% { transform: translate3d(0, 0, -70px) rotateX(240deg) rotateY(550deg); }
}

@keyframes floatRotate29 {
    0% { transform: translate3d(0, 0, 110px) rotateX(-10deg) rotateY(-370deg); }
    50% { transform: translate3d(120px, -110px, 0px) rotateX(-110deg) rotateY(-470deg); }
    100% { transform: translate3d(0, 0, 110px) rotateX(-210deg) rotateY(-570deg); }
}

@keyframes floatRotate30 {
    0% { transform: translate3d(0, 0, -90px) rotateX(50deg) rotateY(390deg); }
    50% { transform: translate3d(135px, 90px, -30px) rotateX(150deg) rotateY(490deg); }
    100% { transform: translate3d(0, 0, -90px) rotateX(250deg) rotateY(590deg); }
}

/* Media Queries for Responsiveness */
@media (max-width: 768px) {
    body { padding: 10px; }
     body::before { background-size: 8px 8px; } /* Adjust pattern size */
    h1.main-title {
        font-size: 2em;
        margin-bottom: 15px;
    }
    .main-content-wrapper {
        gap: 20px;
        padding: 0 10px;
        flex-direction: column; /* Stack columns on smaller screens */
        align-items: center;
    }
     .gradient-container {
        width: 100%; /* Take full width */
        max-width: 320px; /* Limit max width */
     }
    .rgb-gradient {
        width: 100%;
        height: auto; /* Allow height to scale with width */
        padding-top: 100%; /* Maintain 1:1 aspect ratio */
        position: relative; /* Needed for padding hack */
    }
    .rgb-gradient::after { /* Make sure pseudo-element covers the area */
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
    }
    .gradient-legend { font-size: 0.8em; }
    .controls-area {
        width: 100%; /* Take full width */
        max-width: 320px; /* Limit max width */
    }
    .preview { height: 120px; } /* Further reduce preview height */
    .preview-text { font-size: 0.8em; }
    .hsl-sliders { gap: 6px; } /* Smaller gaps */
    .slider-group label { width: auto; }
    .slider-group span.slider-value { width: 25px; }

    .palette-controls-and-history {
         flex-direction: column; /* Stack controls and history */
         gap: 15px; /* Space between stacked sections */
     }
     .palette-controls, .history-area {
         flex-basis: auto; /* Remove base width */
         min-width: auto; /* Remove min width */
         width: 100%; /* Take full width of controls-area */
     }
     .history-area {
         flex-direction: column; /* Stack heading and swatches */
         align-items: flex-start; /* Align heading and swatches to the left */
         gap: 8px; /* Space between heading and swatches */
     }
     .history-area h2 { width: auto; } /* Allow heading width to be auto */
     .history-swatches { max-width: 100%; justify-content: center;} /* Allow swatches to use full width */

     .action-buttons { gap: 10px; } /* Smaller gap for buttons */
    .action-button { padding: 10px 20px; font-size: 0.9em; }

    .history-swatch { width: 30px; height: 30px; }
    .palette-bar { min-height: 50px; }
    .palette-bar span { font-size: 0.75em; }
    /* .palette-escape-instruction { font-size: 0.85em; } REMOVED AS IT'S NOW IN PREVIEW */
    .remove-color { width: 20px; height: 20px; font-size: 0.8em; top: 6px; right: 6px; }
     .number-input-arrows { width: 20px; padding-right: 2px;}
    .number-input-arrows .arrow { border-left-width: 5px; border-right-width: 5px; border-bottom-width: 5px; border-top-width: 5px; margin: 2px 0;}

    /* Hide geometric shapes on smaller screens if they become too distracting or perform poorly 
    .geometric-background { display: none; }*/

    /* Show close button on mobile */
    .close-palette-button {
        display: flex; /* Show the close button */
        position: absolute; /* Absolute position relative to palette */
        top: 8px; /* Adjust top spacing */
        right: 8px; /* Adjust right spacing */
        margin: 0; /* Remove auto margin */
        z-index: 1003; /* Ensure it's above other content */
        /* Added button styles */
         background: rgba(255, 255, 255, 0.2); /* Semi-transparent white */
         color: white;
         border: 1px solid rgba(255, 255, 255, 0.3);
         border-radius: 4px;
         width: 30px;
         height: 30px;
         align-items: center;
         justify-content: center;
         font-size: 1.2em;
         cursor: pointer;
         transition: background 0.2s ease, border-color 0.2s ease;
    }

     .close-palette-button:hover {
         background: rgba(255, 255, 255, 0.3);
         border-color: rgba(255, 255, 255, 0.5);
     }
}

@media (max-width: 480px) {
    h1.main-title { font-size: 1.8em; }
    body::before { background-size: 6px 6px; } /* Adjust pattern size */
    .main-content-wrapper { padding: 0 5px; gap: 15px; }
    .gradient-container, .controls-area { max-width: 280px; }
    .rgb-gradient { width: 100%; padding-top: 100%; }
    .preview { height: 100px; }
    .preview-text { font-size: 0.7em; padding: 1px 4px; }
    .slider-group label, .control-group label { font-size: 0.85em; }
    .slider-value { font-size: 0.8em; width: 20px; }
    .action-button { font-size: 0.85em; padding: 8px 15px; }
    .history-area, .export-button { max-width: 280px; }
    .history-area h2 { font-size: 1.2em; }
    .history-swatch { width: 25px; height: 25px; }
    .palette-bar span { font-size: 0.7em; padding: 1px 4px;}
    /* .palette-escape-instruction { font-size: 0.8em; padding: 6px 12px; } REMOVED */
    .number-input-arrows { width: 18px; padding-right: 1px;}
     .number-input-arrows .arrow { border-left-width: 4px; border-right-width: 4px; border-bottom-width: 4px; border-top-width: 4px; margin: 1px 0;}
     .close-palette-button {
        width: 25px;
        height: 25px;
        font-size: 1em;
     }
}